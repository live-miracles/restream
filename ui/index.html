<!doctype html>
<html lang="en" data-theme="dim">
  <head>
    <meta charset="UTF-8" />
    <title data-name="Dashboard">Dashboard</title>
    <link rel="icon" type="image/png" href="logo.png" />
    <link rel="stylesheet" type="text/css" href="output.css" />
    <script type="text/javascript" src="toml-parser.min.js"></script>
    <script type="text/javascript" src="utils.js"></script>
    <script type="text/javascript" src="pipeline.js"></script>
    <script type="text/javascript" src="api.js"></script>
    <script type="text/javascript" src="dashboard.js" defer></script>
  </head>
  <body class="bg-base-100 text-base-content flex h-screen flex-col">
    <div class="navbar bg-base-100 shrink-0">
      <div class="flex-1">
        <button class="btn btn-ghost text-xl" id="server-name" onclick="selectPipeline(null)">Restream</button>
      </div>
      <div class="flex-none">
        <ul class="menu menu-horizontal px-1">
          <li><a href="/stream-keys.html" class="dynamic-params">Keys</a></li>
          <li><a href="https://github.com/live-miracles/restream" target="_blank">GitHub</a></li>
        </ul>
      </div>
    </div>

    <div
      id="streaming-config-changed-alert"
      role="alert"
      class="alert alert-warning fixed top-3 left-1/2 z-999 hidden max-w-175 -translate-x-1/2 transform opacity-90">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
      <span>Warning: The streaming configurations were changed by someone. Please refresh the page.</span>
    </div>

    <div role="alert" id="error-alert" class="alert alert-error fixed top-3 left-1/2 z-999 hidden max-w-175 -translate-x-1/2 transform opacity-90">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span id="error-msg"></span>
    </div>

    <dialog id="edit-out-modal" class="modal">
      <div class="modal-box max-w-200">
        <input type="text" id="out-pipe-id-input" class="hidden" />
        <input type="text" id="out-id-input" class="hidden" />

        <div class="focus mx-auto mt-2 w-full max-w-200 space-y-3 px-4">
          <h2 class="text-xl font-bold">Edit Output "<span id="out-name-span"></span>"</h2>

          <fieldset class="fieldset inline-block w-64">
            <legend class="fieldset-legend">Output Name</legend>
            <input type="text" id="out-name-input" class="input" placeholder="Type here" />
          </fieldset>

          <fieldset class="fieldset ml-2 inline-block w-40">
            <legend class="fieldset-legend">Encoding</legend>

            <select class="select" id="out-encoding-input">
              <option selected="" value="source">Source</option>
              <option value="vertical">Vertical</option>
              <option value="720p">720p</option>
              <option value="720p">1080p</option>
            </select>
          </fieldset>

          <fieldset class="fieldset ml-2 inline-block w-40">
            <legend class="fieldset-legend">Server URL</legend>

            <select class="select" id="out-server-url-input">
              <option selected="" value="">Custom</option>
              <option value="rtmp://a.rtmp.youtube.com/live2/">YouTube</option>
              <option value="rtmp://b.rtmp.youtube.com/live2?backup=1/">YT Backup</option>
              <option value="rtmps://live-api-s.facebook.com:443/rtmp/">Facebook</option>
              <option value="rtmps://edgetee-upload-${s_prp}.xx.fbcdn.net:443/rtmp/">Instagram</option>
              <option value="rtmp://live-ingest-01.vd0.co:1935/livestream/">VDO Cipher</option>
              <option value="rtmp://ovsu.okcdn.ru/input/">VK Video</option>
            </select>
          </fieldset>

          <fieldset class="fieldset">
            <legend class="fieldset-legend">Stream Key or Custom URL</legend>
            <input type="text" id="out-rtmp-key-input" class="input w-full" placeholder="Type here" />
          </fieldset>
        </div>

        <div class="modal-action">
          <form method="dialog">
            <button class="btn mx-2">Cancel</button>
            <button class="btn btn-accent" onclick="editOutFormBtn(event)">Update</button>
          </form>
        </div>
      </div>
    </dialog>

    <div class="grid h-screen min-h-0 flex-1 grid-cols-[200px_auto_1fr] gap-4 p-4 pt-0">
      <!-- Left Column -->
      <div class="bg-base-300 rounded-box w-full overflow-y-auto">
        <div id="pipe-overwiew" class="p-4">
          <div>
            <div aria-label="status" class="status status-success"></div>
            <span id="on-pipes"></span> pipes | <span id="on-outs"></span> outs
          </div>
          <div>
            <div aria-label="status" class="status status-error"></div>
            <span id="out-errors"></span> out errors
          </div>
          <div>
            <div aria-label="status" class="status status-warning"></div>
            <span id="out-warnings"></span> out warnings
          </div>
        </div>
        <ul class="menu rounded-box w-full" id="pipelines"></ul>
        <div class="mt-3 w-full text-center">
          <button class="btn btn-xs btn-accent btn-outline" id="add-pipe-btn" onclick="addPipeBtn()">Add Pipeline</button>
        </div>
      </div>

      <!-- Middle Column -->
      <div class="bg-base-200 hidden overflow-y-auto rounded-xl p-4 shadow" id="pipe-info-col">
        <div class="stats shadow">
          <div class="stats shadow">
            <div class="stat p-3">
              <div class="stat-title">CPU</div>
              <div class="stat-value cpu-metric text-sm">...</div>
            </div>
            <div class="stat p-3">
              <div class="stat-title">RAM</div>
              <div class="stat-value ram-metric text-sm">...</div>
            </div>
            <div class="stat p-3">
              <div class="stat-title">Disk</div>
              <div class="stat-value disk-metric text-sm">...</div>
            </div>
            <div class="stat p-3">
              <div class="stat-title">Download</div>
              <div class="stat-value downlink-metric text-sm">...</div>
            </div>
            <div class="stat p-3">
              <div class="stat-title">Upload</div>
              <div class="stat-value uplink-metric text-sm">...</div>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div>
          <div class="mb-3 flex items-center gap-2 text-xl font-bold">
            <span id="pipe-name"></span>
            <button class="btn btn-xs btn-accent btn-outline" id="edit-pipe-btn" onclick="editPipeBtn()">âœŽ</button>
            <button class="btn btn-xs btn-accent btn-outline" id="delete-pipe-btn" onclick="deletePipeBtn()">âœ–</button>
            <span class="badge" id="input-time"></span>
          </div>

          <div class="text-center" id="video-player">
            <!-- TODO: add player -->
          </div>

          <div id="input-stats">
            <h2 class="text-lg">Video</h2>
            <div class="stats mt-1 shadow">
              <div class="stat p-3">
                <div class="stat-title">Codec</div>
                <div class="stat-value text-sm" id="input-video-codec"></div>
              </div>

              <div class="stat p-3">
                <div class="stat-title">Resolution</div>
                <div class="stat-value text-sm" id="input-video-resolution"></div>
              </div>

              <div class="stat p-3">
                <div class="stat-title">FPS</div>
                <div class="stat-value text-sm" id="input-video-fps"></div>
              </div>

              <div class="stat p-3">
                <div class="stat-title">Level</div>
                <div class="stat-value text-sm" id="input-video-level"></div>
              </div>

              <div class="stat p-3">
                <div class="stat-title">Profile</div>
                <div class="stat-value text-sm" id="input-video-profile"></div>
              </div>

              <div class="stat p-3">
                <div class="stat-title">Kb/s</div>
                <div class="stat-value text-sm" id="input-video-bw"></div>
              </div>
            </div>

            <h2 class="mt-3 text-lg">Audio</h2>
            <div class="stats mt-1 shadow">
              <div class="stat p-3">
                <div class="stat-title">Codec</div>
                <div class="stat-value text-sm" id="input-audio-codec"></div>
              </div>

              <div class="stat p-3">
                <div class="stat-title">Channels</div>
                <div class="stat-value text-sm" id="input-audio-channels"></div>
              </div>

              <div class="stat p-3">
                <div class="stat-title">Sample Rate</div>
                <div class="stat-value text-sm" id="input-audio-sample-rate"></div>
              </div>

              <div class="stat p-3">
                <div class="stat-title">Profile</div>
                <div class="stat-value text-sm" id="input-audio-profile"></div>
              </div>

              <div class="stat p-3">
                <div class="stat-title">Kb/s</div>
                <div class="stat-value text-sm" id="input-audio-bw"></div>
              </div>
            </div>
          </div>
          <div class="divider"></div>
          <div class="prose mt-2">
            <div>
              Server URL: <code id="server-url" data-copy=""></code>
              <button class="btn btn-xs btn-accent btn-outline" onclick="copyData('server-url')">ðŸ“‹</button>
            </div>
            <div class="mt-1">
              Stream Key: <code id="stream-key" data-copy=""></code>
              <button id="copy-btn" class="btn btn-xs btn-accent btn-outline" onclick="copyData('stream-key')">ðŸ“‹</button>
            </div>
            <div class="mt-1">
              RTMP URL: <code id="rtmp-url" data-copy=""></code>
              <button id="copy-btn" class="btn btn-xs btn-accent btn-outline" onclick="copyData('rtmp-url')">ðŸ“‹</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="bg-base-200 hidden overflow-y-auto rounded-xl p-4 shadow" id="outs-col">
        <h2 class="mb-3 text-xl font-bold">Outputs</h2>
        <div class="space-y-3" id="outputs-list"></div>
        <div class="mt-3 w-full text-center">
          <button class="btn btn-xs btn-accent btn-outline" id="add-out-btn" onclick="addOutBtn()">Add Output</button>
        </div>
      </div>

      <!-- Stats Column -->
      <div class="bg-base-200 hidden overflow-y-auto rounded-xl p-4 shadow" id="stats-col">
        <div class="stats server-stats shadow"></div>

        <div class="divider"></div>

        <div class="overflow-x-auto">
          <table class="table">
            <!-- head -->
            <thead>
              <tr>
                <th>Time</th>
                <th>Name</th>
                <th>Kb/s</th>
                <th>Codec</th>
                <th>Size</th>
                <th>FPS</th>
                <th>Kb/s</th>
                <th>Codec</th>
                <th>Ch</th>
                <th>Freq</th>
              </tr>
            </thead>
            <tbody id="stats-table">
              <tr>
                <th>1</th>
                <td>Cy Ganderton</td>
                <td>Quality Control Specialist</td>
                <td>Blue</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
</html>
